{% comment %}
Lists posts with front matter: industrial: true
Relies only on Liquid filters supported by GitHub Pages (no where_exp).
{% endcomment %}

{% assign industrial_posts = site.posts | where: "industrial", true | sort: "date" | reverse %}

{% for post in industrial_posts %}
  {% comment %} resolve partner metadata if available {% endcomment %}
  {% assign partner = nil %}
  {% if post.partner_key and site.data.partners and site.data.partners[post.partner_key] %}
    {% assign partner = site.data.partners[post.partner_key] %}
  {% endif %}

  <article class="project-card">
    <div class="project-body">
      <h3><a href="{{ post.url | relative_url }}">{{ post.title }}</a></h3>

      <p class="project-meta">
        {{ post.date | date: "%Y-%m-%d" }}
        {% if partner and partner.name %}
          | Partner:
          {% if partner.url %}
            <a href="{{ partner.url }}" target="_blank" rel="nofollow noopener">{{ partner.name }}</a>
          {% else %}
            {{ partner.name }}
          {% endif %}
        {% elsif post.partner_key %}
          | Partner: {{ post.partner_key }}
        {% endif %}
      </p>

      {% if post.excerpt %}
        <p>{{ post.excerpt | strip_html | truncate: 220 }}</p>
      {% else %}
        <p>{{ post.content | strip_html | truncate: 220 }}</p>
      {% endif %}
    </div>
  </article>
{% endfor %}
