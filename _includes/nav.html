<!-- Navigation -->
{% if page.nav-style == "invert" or page.header-style == "text" %}
<nav class="navbar navbar-default navbar-custom navbar-fixed-top invert">
{% else %}
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
{% endif %}
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="{{ site.baseurl }}/">{{ site.title }}</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div id="huxblog_navbar">
      <div class="navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="{{ site.baseurl }}/">Home</a></li>

          {%- comment -%}
          Build the page list for the navbar:
          - must have a title
          - not explicitly hidden
          Then render in two passes:
          1) pages with nav_order, sorted by nav_order
          2) pages without nav_order, sorted by title
          {%- endcomment -%}
          {% assign nav_pages = site.pages
               | where_exp: "p", "p.title"
               | where_exp: "p", "p.hide-in-nav != true" %}

          {% assign ordered_pages = nav_pages
               | where_exp: "p", "p.nav_order"
               | sort: "nav_order" %}

          {% assign unordered_pages = nav_pages
               | where_exp: "p", "p.nav_order == nil"
               | sort: "title" %}

          {% for p in ordered_pages %}
            <li><a href="{{ p.url | prepend: site.baseurl }}">{{ p.title }}</a></li>
          {% endfor %}
          {% for p in unordered_pages %}
            <li><a href="{{ p.url | prepend: site.baseurl }}">{{ p.title }}</a></li>
          {% endfor %}
        </ul>
      </div>
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav>

<script>
  // Drop Bootstrap low-performance Navbar
  // Use customized navbar with CSS3 animation
  var $body     = document.body;
  var $toggle   = document.querySelector('.navbar-toggle');
  var $navbar   = document.querySelector('#huxblog_navbar');
  var $collapse = document.querySelector('.navbar-collapse');

  var __HuxNav__ = {
    close: function(){
      $navbar.className = " ";
      setTimeout(function(){
        if($navbar.className.indexOf('in') < 0) {
          $collapse.style.height = "0px";
        }
      }, 400);
    },
    open: function(){
      $collapse.style.height = "auto";
      $navbar.className += " in";
    }
  };

  // Bind Event
  $toggle.addEventListener('click', function(e){
    if ($navbar.className.indexOf('in') > 0) {
      __HuxNav__.close();
    } else {
      __HuxNav__.open();
    }
  });

  // Close when clicking outside
  document.addEventListener('click', function(e){
    if (e.target == $toggle) return;
    if (e.target.className == 'icon-bar') return;
    __HuxNav__.close();
  });
</script>
